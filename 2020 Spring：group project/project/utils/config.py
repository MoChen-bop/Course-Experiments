from __future__ import print_function
from __future__ import unicode_literals
from utils.collect import Config
import numpy as np


cfg = Config()

cfg.DEVICE = 'cuda:0'
cfg.BATCH_SIZE = 16 # 128 # 32


# cfg.AUG.IMAGE_MEAN = [0.485, 0.456, 0.406]
# cfg.AUG.IMAGE_STD = [0.229, 0.224, 0.225]
cfg.AUG.IMAGE_MEAN = [0.5, 0.5, 0.5]
cfg.AUG.IMAGE_STD = [0.5, 0.5, 0.5]

# ========================================================== DATASET ===================================================================

cfg.DATASET.DATA_FEEDER_NUM = 2

cfg.DATASET.FLOWER.IMAGE_SIZE = 256
cfg.DATASET.FLOWER.IMAGE_DIR = '../data/flower/102flowers'
cfg.DATASET.FLOWER.TEXT_EMBEDDING_DIR = '../data/emb_hdgan_flower/all'
cfg.DARASET.FLOWER.AVAIL_CLASS_FN = '../data/cvpr2016_flowers/allclasses.txt'

cfg.DATASET.CUB.IMAGE_SIZE = 64
cfg.DATASET.CUB.IMAGE_DIR = '../data/bird/CUB_200_2011/images'
cfg.DATASET.CUB.TEXT_EMBEDDING_DIR = '../data/emb_hdgan_bird/all'
cfg.DARASET.CUB.AVAIL_CLASS_FN = '../data/cvpr2016_cub/allclasses.txt'

cfg.DATASET.TEXT_EMBEDDING_CUB.DATASET_DIR = '../data/cvpr2016_cub'
cfg.DATASET.TEXT_EMBEDDING_CUB.AVAIL_CLASS_FN = 'allclasses.txt'
cfg.DATASET.TEXT_EMBEDDING_CUB.IMAGE_DIR = 'images_h5'
cfg.DATASET.TEXT_EMBEDDING_CUB.TEXT_DIR = 'text_c10'
cfg.DATASET.TEXT_EMBEDDING_CUB.TEXT_EMD_DIR = 'text_emb1024'
cfg.DATASET.TEXT_EMBEDDING_CUB.TEXT_CUTOFF = 200

cfg.DATASET.TEXT_EMBEDDING_FLOWER.DATASET_DIR = '../data/cvpr2016_flowers'
cfg.DATASET.TEXT_EMBEDDING_FLOWER.AVAIL_CLASS_FN = 'allclasses.txt'
cfg.DATASET.TEXT_EMBEDDING_FLOWER.IMAGE_DIR = 'images_h5'
cfg.DATASET.TEXT_EMBEDDING_FLOWER.TEXT_DIR = 'text_c10'
cfg.DATASET.TEXT_EMBEDDING_FLOWER.TEXT_EMD_DIR = 'text_emb1024'
cfg.DATASET.TEXT_EMBEDDING_FLOWER.TEXT_CUTOFF = 200

cfg.DATASET.TEXT_EMBEDDING_LAZY.TEXT_CUTOFF = 200
cfg.DATASET.TEXT_EMBEDDING_LAZY.HDGAN.CUB.DATASET_DIR = '../data/emb_hdgan_bird/all'
cfg.DATASET.TEXT_EMBEDDING_LAZY.HDGAN.CUB.TEXT_DIR = '../data/emb_hdgan_bird'
cfg.DATASET.TEXT_EMBEDDING_LAZY.HDGAN.FLOWER.DATASET_DIR = '../data/emb_hdgan_flower/all'
cfg.DATASET.TEXT_EMBEDDING_LAZY.HDGAN.FLOWER.TEXT_DIR = '../data/emb_hdgan_flower'
cfg.DATASET.TEXT_EMBEDDING_LAZY.HDGAN.COCO.DATASET_DIR = '../data/emb_hdgan_coco/train'
cfg.DATASET.TEXT_EMBEDDING_LAZY.HDGAN.COCO.TEXT_DIR = 'dummy'

cfg.DATASET.TEXT_EMBEDDING_LAZY.STACKGAN.COCO.DATASET_DIR = '../data/emb_stackgan_coco/coco/coco/train'
cfg.DATASET.TEXT_EMBEDDING_LAZY.STACKGAN.COCO.TEXT_DIR = 'dummy'

cfg.DATASET.COCO.SIZE = 117266
cfg.DATASET.COCO.IMAGE_SIZE = 512
cfg.DATASET.COCO.CATEGORIES = 90
cfg.DATASET.COCO.TRAIN_IMAGE_DIR = '/mnt/2020project/Assets/Datasets/coco/train2017'
cfg.DATASET.COCO.TRAIN_IMAGE_LABEL_DIR = '/mnt/2020project/Assets/Datasets/coco/annotations/image_label_train2017.json'
cfg.DATASET.COCO.TRAIN_INSTANCES_DIR = '/mnt/2020project/Assets/Datasets/coco/annotations/instances_train2017.json'

# ========================================================== TRAIN ===================================================================

cfg.TRAIN.SAVE_DIR = '../saved_models'
cfg.TRAIN.LOG_DIR = '../logs'
cfg.TRAIN.VIS_DIR = '../visualize'
cfg.TRAIN.LEARNING_RATE = 0.0001
cfg.TRAIN.WORKERS = 4

cfg.TRAIN.TEXT_EMBEDDING.TEXT_EMBEDDING_DATASET = 'cub'
#cfg.TRAIN.TEXT_EMBEDDING_DATASET = 'flower'
cfg.TRAIN.TEXT_EMBEDDING.LR_DECAY = True
cfg.TRAIN.TEXT_EMBEDDING.MAX_STEP = 400000
cfg.TRAIN.TEXT_EMBEDDING.LOG_INTERVAL = 100
cfg.TRAIN.TEXT_EMBEDDING.SAVE_INTERVAL = 10000
cfg.TRAIN.TEXT_EMBEDDING.RESUME_DIR = '../saved_models/CRNN/CUBDataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_180000.pth'

cfg.TRAIN.TEXT_EMBEDDING_LAZY.DATASET = 'coco'
cfg.TRAIN.TEXT_EMBEDDING_LAZY.RESUME_DIR = '' #'../saved_models/CRNN_LAZY/COCODataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_100.pth'
cfg.TRAIN.TEXT_EMBEDDING_LAZY.MAX_EPOCH = 400
cfg.TRAIN.TEXT_EMBEDDING_LAZY.LOG_INTERVAL = 100
cfg.TRAIN.TEXT_EMBEDDING_LAZY.SAVE_INTERVAL = 100

cfg.TRAIN.XCEPTION.RESUME_DIR = ''
cfg.TRAIN.XCEPTION.MAX_STEP = 100
cfg.TRAIN.XCEPTION.LOG_INTERVAL = 32
cfg.TRAIN.XCEPTION.SAVE_INTERVAL = 1
cfg.TRAIN.XCEPTION.RESUME_DIR = '../saved_models/Xception/COCOClsDataset/Xception_2.pth'


cfg.DATASET.STACKGAN.IMAGE_SIZE = 256 # 64
cfg.TRAIN.STACKGAN.DATASET = 'cub'
cfg.TRAIN.STACKGAN.STAGE = 2
cfg.TRAIN.STACKGAN.PRETRAINED_MODEL.STAGE1_G = '../saved_models/StackGAN/CUBDataset/Stage1_G/Stage1_G_192_128_100_595.pth' 
#'../saved_models/StackGAN/CUBDataset/Stage1_G/Stage1_G_128_128_100_45.pth'
cfg.TRAIN.STACKGAN.PRETRAINED_MODEL.STAGE1_D = '' # '../saved_models/StackGAN/FlowerDataset/Stage1_D/Stage1_D_64_128_100_500.pth' 
#'../saved_models/StackGAN/CUBDataset/Stage1_D/Stage1_D_64_128_100_45.pth'
cfg.TRAIN.STACKGAN.PRETRAINED_MODEL.STAGE2_G = '../saved_models/StackGAN/CUBDataset/Stage2_G/Stage2_G_192_128_100_30.pth'
cfg.TRAIN.STACKGAN.PRETRAINED_MODEL.STAGE2_D = '../saved_models/StackGAN/CUBDataset/Stage2_D/Stage2_D_96_128_100_30.pth'
cfg.TRAIN.STACKGAN.DISCRIMINATOR_LR = 2e-4
cfg.TRAIN.STACKGAN.GENERATOR_LR = 2e-4
cfg.TRAIN.STACKGAN.COEFF_KL = 2.0
cfg.TRAIN.STACKGAN.BEGIN_EPOCH = 31
cfg.TRAIN.STACKGAN.DECAY_EPOCH = 100
cfg.TRAIN.STACKGAN.MAX_EPOCH = 600
cfg.TRAIN.STACKGAN.LOG_INTERVAL = 10
cfg.TRAIN.STACKGAN.SAVE_INTERVAL = 5
cfg.TRAIN.STACKGAN.VIS_INTERVAL = 50


cfg.EVAL.TEXT_EMBEDDING.BATCH_SIZE = 10
cfg.EVAL.TEXT_EMBEDDING_DATASET = 'flower'
cfg.EVAL.TEXT_EMBEDDING.PRETRAINED_MODEL = '../saved_models/CRNN/FlowerDataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_200000.pth'
cfg.EVAL.TEXT_EMBEDDING.OUTPUT_DIR = '../data/cvpr2016_flowers/text_emb1024'
cfg.EVAL.TEXT_EMBEDDING.LOG_INTERVAL = 20

# ========================================================== MODEL ===================================================================

cfg.MODEL.CRNN.CONV_CHANNELS = [348, 512, 512]
cfg.MODEL.CRNN.CONV_KERNELS = [4, 4, 4]
cfg.MODEL.CRNN.CONV_STRIDES = [3, 3, 3]
cfg.MODEL.CRNN.RNN_BIDIR = False
cfg.MODEL.CRNN.RNN_DROPOUT = 0.3
cfg.MODEL.CRNN.LIN_DROPOUT = 0
cfg.MODEL.CRNN.CONV_DROPOUT = 0
cfg.MODEL.CRNN.RNN_HIDDEN_SIZE = 512
cfg.MODEL.CRNN.RNN_NUM_LAYERS = 1
cfg.MODEL.CRNN.LSTM = True


cfg.MODEL.STACKGAN.TEXT_DIM = 1024
cfg.MODEL.STACKGAN.GF_DIM = 192
cfg.MODEL.STACKGAN.DF_DIM = 96
cfg.MODEL.STACKGAN.CONDITION_DIM = 128
cfg.MODEL.STACKGAN.Z_DIM = 100
cfg.MODEL.STACKGAN.R_NUM = 2


cfg.MODEL.MIRRORGAN.TRAIN_FLAG = False
cfg.MODEL.MIRRORGAN.GLOBAL_ATTEN_ON = True
cfg.MODEL.MIRRORGAN.TEXT.WORDS_NUM = 18
cfg.MODEL.MIRRORGAN.Z_DIM = 100
cfg.MODEL.MIRRORGAN.R_NUM = 2
cfg.MODEL.MIRRORGAN.RNN_TYPE = 'LSTM'
cfg.MODEL.MIRRORGAN.GF_DIM  = 128
cfg.MODEL.MIRRORGAN.EMBEDDING_DIM = 256
cfg.MODEL.MIRRORGAN.CONDITION_DIM = 100
cfg.MODEL.MIRRORGAN.TREE.BRANCH_NUM = 3
cfg.MODEL.MIRRORGAN.DF_DIM = 64


# ========================================================= DEPLOY ==================================================

cfg.DEPLOY.VIS_DIR = '../visualize/deploy'

cfg.DEPLOY.VOCAB_DIM = 69

cfg.DEPLOY.CRNN.STACK_GAN.COCO.PRETRAINED_MODEL = '../saved_models/CRNN_LAZY/STACKGAN/COCODataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_final.pth'
cfg.DEPLOY.CRNN.HDGAN.CUB.PRETRAINED_MODEL = '../saved_models/CRNN_LAZY/HDGAN/CUBDataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_500.pth'
cfg.DEPLOY.CRNN.HDGAN.FLOWER.PRETRAINED_MODEL = '../saved_models/CRNN_LAZY/HDGAN/FlowerDataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_500.pth'
cfg.DEPLOY.CRNN.HDGAN.COCO.PRETRAINED_MODEL = '../models/HDGAN/COCODataset/CRNN_69_348_512_512_4_4_4_3_3_3_LSTM_512_1_final.pth'

cfg.DEPLOY.SINGLE_GAN.CUB.PRETRAINED_MODEL = ''
cfg.DEPLOY.SINGLE_GAN.FLOWER.PRETRAINED_MODEL = ''
cfg.DEPLOY.SINGLE_GAN.COCO.PRETRAINED_MODEL = ''

cfg.DEPLOY.STACK_GAN.CUB.PRETRAINED_MODEL = ''
cfg.DEPLOY.STACK_GAN.FLOWER.PRETRAINED_MODEL = '../saved_models/StackGAN/FlowerDataset/Stage2_G/Stage2_G_192_128_100_300.pth'
cfg.DEPLOY.STACK_GAN.COCO.PRETRAINED_MODEL = '../pretrain_models/StackGAN/coco/coco_netG_epoch_90.pth'

cfg.DEPLOY.HDGAN.CUB.PRETRAINED_MODEL = '../pretrain_models/HDGAN/birds_256/G_epoch500.pth'
cfg.DEPLOY.HDGAN.FLOWER.PRETRAINED_MODEL = '../pretrain_models/HDGAN/flower_256/G_epoch580.pth'
cfg.DEPLOY.HDGAN.COCO.PRETRAINED_MODEL = '../models/pretrain_models/HDGAN/coco_256/G_epoch200.pth'

cfg.DEPLOY.DEVICE = 'cuda'
cfg.DEPLOY.TEXT_CUTOFF = 200

cfg.DEPLOY.CRNN.CONV_CHANNELS = [348, 512, 512]
cfg.DEPLOY.CRNN.CONV_KERNELS = [4, 4, 4]
cfg.DEPLOY.CRNN.CONV_STRIDES = [3, 3, 3]
cfg.DEPLOY.CRNN.RNN_BIDIR = False
cfg.DEPLOY.CRNN.RNN_DROPOUT = 0.3
cfg.DEPLOY.CRNN.LIN_DROPOUT = 0
cfg.DEPLOY.CRNN.CONV_DROPOUT = 0
cfg.DEPLOY.CRNN.RNN_HIDDEN_SIZE = 512
cfg.DEPLOY.CRNN.RNN_NUM_LAYERS = 1
cfg.DEPLOY.CRNN.LSTM = True

cfg.DEPLOY.TEXT_EMBEDDING_DIM = 1024
cfg.DEPLOY.NOISE_DIM = 100

cfg.DEPLOY.SINGLEGAN.NC = 3
cfg.DEPLOY.SINGLEGAN.NGF = 64

cfg.DEPLOY.STACKGAN.GF_DIM = 192
cfg.DEPLOY.STACKGAN.DF_DIM = 96
cfg.DEPLOY.STACKGAN.CONDITION_DIM = 128
cfg.DEPLOY.STACKGAN.Z_DIM = 100
cfg.DEPLOY.STACKGAN.R_NUM = 2

cfg.DEPLOY.HDGAN.EMB_DIM = 128
cfg.DEPLOY.HDGAN.HID_DIM = 128
cfg.DEPLOY.HDGAN.NUM_RESBLOCK = 1
